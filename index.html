<head>
    <title>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</title>
    <link rel="stylesheet" href="styles.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Inter' rel='stylesheet'>
</head>

<head>
    <title>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</title>
    <link rel="stylesheet" href="styles.css">
    <meta charset="UTF-8">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>

<body>
    <div class="navbar">
        <div class="infoDateBlock" id="today_naming"></div>
    </div>

    <div class="main">
        <div class="listInfo" id="listInfo">
        </div>
    </div>
    <div id="overlay"></div>
    <div id="selecterDay">
        –í—ã–±–µ—Ä–∏ –¥–µ–Ω—å:
        <div class="days">
            <button onclick="selectD(1)">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫</button>
            <button onclick="selectD(2)">–í—Ç–æ—Ä–Ω–∏–∫</button>
            <button onclick="selectD(3)">–°—Ä–µ–¥–∞</button>
            <button onclick="selectD(4)">–ß–µ—Ç–≤–µ—Ä–≥</button>
            <button onclick="selectD(5)">–ü—è—Ç–Ω–∏—Ü–∞</button>
            <button onclick="selectD(6)">–°—É–±–±–æ—Ç–∞</button>
        </div>
    </div>
    <div id="selecterName">
        –í—ã–±–µ—Ä–∏ –Ω–µ–¥–µ–ª—é:
        <div class="days">
            <button onclick="selectDN('–ß–∏—Å–ª–∏—Ç–µ–ª—å')">–ß–∏—Å–ª–∏—Ç–µ–ª—å</button>
            <button onclick="selectDN('–ó–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å')">–ó–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å</button>
        </div>
    </div>
</body>

<script>
    const shortNameDay = ["–í—Å", "–ü–Ω", "–í—Ç", "–°—Ä", "–ß—Ç", "–ü—Ç", "–°—É–±"];
    const nameDay = ["–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ", "–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫", "–í—Ç–æ—Ä–Ω–∏–∫", "–°—Ä–µ–¥–∞", "–ß–µ—Ç–≤–µ—Ä–≥", "–ü—è—Ç–Ω–∏—Ü–∞", "–°—É–±–±–æ—Ç–∞"];

    const shower = document.getElementById("listInfo")
    const selecterName = document.getElementById('selecterName');
    const overlay = document.getElementById('overlay')
    const selecterDay = document.getElementById('selecterDay')
    const addToHomeScreen = document.getElementById('addToHomeScreen');

    var lastselectday = 1;

    function getTodayNumber(tommorow = false) {
        const today = new Date();
        if (tommorow) {
            today.setDate(today.getDate() + 1);
        }
        const dayOfWeek = today.getDay();
        return dayOfWeek
    }


    function getNowWeekName(tommorow = false) {
        var today = new Date();

        if (tommorow) {
            today.setDate(today.getDate() + 1);
        }

        var dd = today.getDate();
        var mm = today.getMonth() + 1;
        var yyyy = today.getFullYear();
        var newYear = false;
        if (dd < 10) {
            dd = '0' + dd;
        }
        if (mm < 10) {
            mm = '0' + mm;
        }
        if (mm < 9) {
            newYear = true;
            Yseptember = yyyy - 1
            var september = new Date(yyyy - 1, 8, 1);
        } else {
            Yseptember = yyyy
            var september = new Date(yyyy, 8, 1);
        }
        dayOfSeptember = (september.getDay() + 6) % 7;

        if (dayOfSeptember == 6) {
            firstWeak = new Date(Yseptember, 8, 1)
        } else {
            firstWeak = new Date(Yseptember, 7, 31 - dayOfSeptember)
        }

        var WeaksNumber = Math.ceil((today - firstWeak) / (7 * 24 * 60 * 60 * 1000)) - 1;
        if (WeaksNumber % 2 == 0) {
            today = '–ß–∏—Å–ª–∏—Ç–µ–ª—å';
        } else {
            today = '–ó–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å';
        }
        return today
    }

    function parseToNormalView(array) {

        time = `${array[1]} - ${array[2]}`
        name = `${array[3]}`
        switch (array[4]) {
            case "–õ":
                type = "–õ–µ–∫—Ü–∏—è";
                break;
            case "–õ–∞–±":
                type = "–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞";
                break;
            case "–ü—Ä":
                type = "–ü—Ä–∞–∫—Ç–∏–∫–∞";
                break;
            default:
                type = "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø";
        }
        teacher = array[5]
        number = array[6]

        text = `‚åö ${time}<br>
üìñ ${name}<br>
üîé ${type}<br>
üßë‚Äçüè´ ${teacher}<br>
üö™ ${number}<br>`
        return text
    }

    const schedulejson = {
        "–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫":
            "08:30-10:00 –¢–µ–æ—Ä–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è (–õ), –¥–æ—Ü–µ–Ω—Ç –ó–∞–¥–æ—Ä–æ–∂–Ω–µ–≤–∞ –Æ.–í., –ê—É–¥. 1-19 –ú<br>10:10-11:40 –¢–µ–æ—Ä–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è (–õ–∞–±), –¥–æ—Ü–µ–Ω—Ç –ó–∞–¥–æ—Ä–æ–∂–Ω–µ–≤–∞ –Æ.–í., –ê—É–¥. 2-3–± –ú",
        "–í—Ç–æ—Ä–Ω–∏–∫": {
            "–ß–∏—Å–ª–∏—Ç–µ–ª—å": "12:00-13:30 –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—Ç—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (–õ), –¥–æ—Ü–µ–Ω—Ç –°—Ç–µ–±–µ–Ω—å–∫–æ–≤–∞ –ù.–ê., –ê—É–¥. 2-17 –ú<br>13:40-15:10 –¢–µ–æ—Ä–∏—è —ç–ª–µ–∫—Ç—Ä–æ—Å–≤—è–∑–∏ (–õ), —Å—Ç–∞—Ä—à–∏–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –ï—Ä–º–∞–∫–æ–≤–∞ –ù.–ù., –ê—É–¥. 2-17 –ú<br>15:20-16:50 –¢–µ–æ—Ä–∏—è —ç–ª–µ–∫—Ç—Ä–æ—Å–≤—è–∑–∏ (–ü—Ä), —Å—Ç–∞—Ä—à–∏–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –ï—Ä–º–∞–∫–æ–≤–∞ –ù.–ù., –ê—É–¥. 2-17 –ú<br>17:00-18:30 –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞ –∏ —Å—Ö–µ–º–æ—Ç–µ—Ö–Ω–∏–∫–∞ (–ü—Ä), –¥–æ—Ü–µ–Ω—Ç –°—Ç–µ–±–µ–Ω—å–∫–æ–≤ –ê.–ú., –ê—É–¥. 2-17 –ú",
            "–ó–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å": "12:00-13:30 –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—Ç—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (–ü—Ä), –¥–æ—Ü–µ–Ω—Ç –°—Ç–µ–±–µ–Ω—å–∫–æ–≤–∞ –ù.–ê., –ê—É–¥. 2-17 –ú<br>13:40-15:10 –¢–µ–æ—Ä–∏—è —ç–ª–µ–∫—Ç—Ä–æ—Å–≤—è–∑–∏ (–õ), —Å—Ç–∞—Ä—à–∏–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –ï—Ä–º–∞–∫–æ–≤–∞ –ù.–ù., –ê—É–¥. 2-17 –ú<br>15:20-16:50 <br>17:00-18:30 "
        },
        "–°—Ä–µ–¥–∞": "13:40-15:10 –°–µ—Ç–∏ –∏ —Å–∏—Å—Ç–µ–º—ã –ø–µ—Ä–µ–¥–∞—á–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (–õ), –¥–æ—Ü–µ–Ω—Ç –†–æ–º–∞—Å–µ–≤–∏—á –ü.–í., –ê—É–¥. 2-13 –ú<br>15:20-16:50 –°–µ—Ç–∏ –∏ —Å–∏—Å—Ç–µ–º—ã –ø–µ—Ä–µ–¥–∞—á–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (–ü—Ä), –¥–æ—Ü–µ–Ω—Ç –†–æ–º–∞—Å–µ–≤–∏—á –ü.–í., –ê—É–¥. 2-13 –ú<br>17:00-18:30 –¶–∏—Ñ—Ä–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã –ø–µ—Ä–µ–¥–∞—á–∏ (–ü—Ä), –¥–æ—Ü–µ–Ω—Ç –†–æ–º–∞—Å–µ–≤–∏—á –ü.–í., –ê—É–¥. 2-13 –ú",
        "–ß–µ—Ç–≤–µ—Ä–≥": {
            "–ß–∏—Å–ª–∏—Ç–µ–ª—å": "12:00-13:30 –¢–µ–æ—Ä–∏—è —ç–ª–µ–∫—Ç—Ä–æ—Å–≤—è–∑–∏ (–õ–∞–±), —Å—Ç–∞—Ä—à–∏–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –ï—Ä–º–∞–∫–æ–≤–∞ –ù.–ù., –ê—É–¥. 2-06 –ú<br>13:40-15:10 –¢–µ–æ—Ä–∏—è —ç–ª–µ–∫—Ç—Ä–æ—Å–≤—è–∑–∏ (–ü—Ä), —Å—Ç–∞—Ä—à–∏–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –ï—Ä–º–∞–∫–æ–≤–∞ –ù.–ù., –ê—É–¥. 2-06 –ú",
            "–ó–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å": "–ù–µ—Ç"
        },
        "–ü—è—Ç–Ω–∏—Ü–∞": {
            "–ß–∏—Å–ª–∏—Ç–µ–ª—å": "12:00-13:30 –°–∏—Å—Ç–µ–º—ã –∫–æ–º–º—É—Ç–∞—Ü–∏–π (–õ–∞–±), –¥–æ—Ü–µ–Ω—Ç –°–µ–º–µ–Ω–æ–≤ –ï.–°., –ê—É–¥. 2-06 –ú<br>13:40-15:10 –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—Ç—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (–õ–∞–±), –¥–æ—Ü–µ–Ω—Ç –°—Ç–µ–±–µ–Ω—å–∫–æ–≤–∞ –ù.–ê., –ê—É–¥. 2-13–∞ –ú<br>15:20-16:50 –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—Ç—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (–õ–∞–±), –¥–æ—Ü–µ–Ω—Ç –°—Ç–µ–±–µ–Ω—å–∫–æ–≤–∞ –ù.–ê., –ê—É–¥. 1-19 –ú",
            "–ó–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å": "12:00-13:30 –°–∏—Å—Ç–µ–º—ã –∫–æ–º–º—É—Ç–∞—Ü–∏–π (–õ–∞–±), –¥–æ—Ü–µ–Ω—Ç –°–µ–º–µ–Ω–æ–≤ –ï.–°., –ê—É–¥. 2-06 –ú<br>13:40-15:10 –°–∏—Å—Ç–µ–º—ã –∫–æ–º–º—É—Ç–∞—Ü–∏–π (–ü—Ä), –¥–æ—Ü–µ–Ω—Ç –°–µ–º–µ–Ω–æ–≤ –ï.–°., –ê—É–¥. 2-13 –ú<br>15:20-16:50 –¢–µ–æ—Ä–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è (–ü—Ä), –¥–æ—Ü–µ–Ω—Ç –ó–∞–¥–æ—Ä–æ–∂–Ω–µ–≤–∞ –Æ.–í., –ê—É–¥. 1-19 –ú"
        },
        "–°—É–±–±–æ—Ç–∞": "08:30-10:00 –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞ –∏ —Å—Ö–µ–º–æ—Ç–µ—Ö–Ω–∏–∫–∞ (–õ), –¥–æ—Ü–µ–Ω—Ç –°—Ç–µ–±–µ–Ω—å–∫–æ–≤ –ê.–ú., –ê—É–¥. 2-01 –ö<br>10:10-11:40 –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞ –∏ —Å—Ö–µ–º–æ—Ç–µ—Ö–Ω–∏–∫–∞ (–õ–∞–±), –¥–æ—Ü–µ–Ω—Ç –°—Ç–µ–±–µ–Ω—å–∫–æ–≤ –ê.–ú., –ê—É–¥. 3-15 –ö<br>12:00-13:30 –°–µ—Ç–∏ –∏ —Å–∏—Å—Ç–µ–º—ã –ø–µ—Ä–µ–¥–∞—á–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (–õ–∞–±), –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –†–æ–º–∞—Å–µ–≤–∏—á –ï.–ü.,  –ê—É–¥. 2-13–± –ú<br>13:40-15:10 –¶–∏—Ñ—Ä–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã –ø–µ—Ä–µ–¥–∞—á–∏ (–õ–∞–±), –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –†–æ–º–∞—Å–µ–≤–∏—á –ï.–ü.,  –ê—É–¥. 2-13–± –ú"
    }

    function checkSplit(day) {
        if (day === 0) {
            return false
        }
        const infoShedule = schedulejson[nameDay[day]]
        const nowDay = Object.keys(infoShedule)
        if (nowDay.length === 2) {
            return true
        } else {
            return false
        }
    }

    function selectDay() {

        selecterDay.style.display = 'flex';
        overlay.style.display = 'block';


        overlay.onclick = function (event) {
            if (event.target === overlay) {
                selecterDay.style.display = "none";
                selecterName.style.display = "none";
                overlay.style.display = "none";
                addToHomeScreen.style.display = "none";
            }
        };

    }

    function selectName() {


        selecterDay.style.display = 'flex';
        overlay.style.display = 'block';

    }

    function selectD(day) {
        lastselectday = day;
        selecterDay.style.display = "none";
        overlay.style.display = "none";
        if (checkSplit(day)) {
            selecterName.style.display = 'flex';
            overlay.style.display = 'block';
        } else {
            getDaySchedule(day, false)
        }
    }

    function selectDN(name) {
        selecterName.style.display = "none";
        overlay.style.display = "none";
        getDaySchedule(lastselectday, name);
    }

    function getDaySchedule(nameDayC, nameWeekC) {
        if (nameDayC === 0) {
            shower.textContent = "";
            const lessonDiv = document.createElement('div');
            lessonDiv.classList.add('infoBlock')
            lessonDiv.innerHTML = "–í–æ—Å–∫—Ä–µ—Å–µ–Ω–∏–µ, –æ—Ç–¥—ã—Ö–∞–µ–º"
            shower.appendChild(lessonDiv);
            return
        }
        const infoShedule = schedulejson[nameDay[nameDayC]]
        const nowDay = Object.keys(infoShedule)

        const regex = /^(\d{2}:\d{2})-(\d{2}:\d{2})\s(.+?)\s\((–õ|–õ–∞–±|–ü—Ä)\)\s*,\s*(.+?),\s*–ê—É–¥\.\s([\d\-]+[–∞-—è–ê-–Ø]?\s?[–ú–ö]?)$/;

        var textToShow = "";
        shower.textContent = "";
        const lessonDiv = document.createElement('div');
        lessonDiv.classList.add('infoBlock');
        lessonDiv.innerHTML = nameWeekC
            ? `${nameDay[nameDayC]} | ${nameWeekC}`
            : `${nameDay[nameDayC]}`;
        shower.appendChild(lessonDiv);

        if (nowDay.length === 2) {
            const text = infoShedule[nameWeekC]
            const list = text.split("<br>");

            if (text === '–ù–µ—Ç') {
                shower.textContent = "";
                const lessonDiv = document.createElement('div');
                lessonDiv.classList.add('infoBlock')
                lessonDiv.innerHTML = `${nameDay[nameDayC]} | ${nameWeekC} | –ü–∞—Ä –Ω–µ—Ç`
                shower.appendChild(lessonDiv);
                return
            }

            list.forEach(function (element, index, array) {
                const match = element.match(regex);


                const lessonDiv = document.createElement('div');
                lessonDiv.classList.add('infoBlock');

                const lessonDivIn = document.createElement('div');
                console.log(match);
                lessonDivIn.innerHTML = parseToNormalView(match);
                lessonDivIn.classList.add('inInfoBlock');
                lessonDiv.appendChild(lessonDivIn);

                shower.appendChild(lessonDiv);
            });
        } else {

            if (infoShedule === '–ù–µ—Ç') {
                shower.textContent = "";
                const lessonDiv = document.createElement('div');
                lessonDiv.classList.add('infoBlock')
                lessonDiv.innerHTML = `${nameDay[nameDayC]} | –ü–∞—Ä –Ω–µ—Ç`
                shower.appendChild(lessonDiv);
                return
            }

            const list = infoShedule.split("<br>");
            list.forEach(function (element, index, array) {
                const match = element.match(regex);
                const lessonDiv = document.createElement('div');
                lessonDiv.classList.add('infoBlock');


                const lessonDivIn = document.createElement('div');
                console.log(match);
                lessonDivIn.innerHTML = parseToNormalView(match);
                lessonDivIn.classList.add('inInfoBlock');
                lessonDiv.appendChild(lessonDivIn);

                shower.appendChild(lessonDiv);
            });
        }
    }

    var nowToday = false;

    function switchDay() {
        var day = !nowToday ? "–ó–∞–≤—Ç—Ä–∞" : "–°–µ–≥–æ–¥–Ω—è";
        console.log(nowToday);
        console.log(getTodayNumber(true));
        Telegram.WebApp.MainButton.showProgress();
        Telegram.WebApp.MainButton.text = day;
        Telegram.WebApp.MainButton.hideProgress();
        if (!nowToday) {
            nowToday = true;
            if (checkSplit(getTodayNumber())) {
                getDaySchedule(getTodayNumber(), getNowWeekName());
            } else {
                getDaySchedule(getTodayNumber(), false);
            }
        } else {
            nowToday = false;
            if (checkSplit(getTodayNumber(true))) {
                getDaySchedule(getTodayNumber(true), getNowWeekName(true));
            } else {
                getDaySchedule(getTodayNumber(true), false);
            }
        }

    }

    const date = new Date();

    const dd = String(date.getDate()).padStart(2, '0');
    const mm = String(date.getMonth() + 1).padStart(2, '0');
    const yy = String(date.getFullYear());
    const formattedDate = `${dd}.${mm}.${yy}`;

    document.getElementById("today_naming").textContent = `${getNowWeekName()} | ${formattedDate}   `

    switchDay();

    const MyApp = {
        initData: Telegram.WebApp.initData || "",
        initDataUnsafe: Telegram.WebApp.initDataUnsafe || {},

        init(options) {
            Telegram.WebApp.isVerticalSwipesEnabled = false;
            Telegram.WebApp.MainButton.setParams({
                text: "–ó–∞–≤—Ç—Ä–∞",
                position: "left",
                is_visible: true,
            }).onClick(() => {
                switchDay();
            });
            Telegram.WebApp.SecondaryButton.setParams({
                text: "–û–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –¥–µ–Ω—å",
                is_visible: true,
                position: "right",
                textColor: Telegram.WebApp.themeParams.button_text_color,
                color: Telegram.WebApp.themeParams.button_color,
            }).onClick(() => {
                selectDay();
            });


            Telegram.WebApp.ready();
        },
    };
    MyApp.init();
    Telegram.WebApp.SecondaryButton.textColor = Telegram.WebApp.themeParams.button_text_color;
</script>